From ba4406994af1bdaa77e223aec0a9a866a7c24792 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=D0=A1=D0=B5=D0=BC=D0=B5=D0=BD=20=D0=9F=D0=BB=D0=B5=D0=B2?=
 =?UTF-8?q?=D0=B0=D0=BA=D0=BE?= <>
Date: Mon, 21 Sep 2020 20:03:50 +0300
Subject: [PATCH] hot fix

---
 lib/algolia.dart              |  3 ++-
 lib/src/object_reference.dart |  9 +++++----
 pubspec.lock                  | 23 ++++++++++++++++++++++-
 pubspec.yaml                  |  1 +
 4 files changed, 30 insertions(+), 6 deletions(-)

diff --git a/lib/algolia.dart b/lib/algolia.dart
index 11a460e..665b37d 100644
--- a/lib/algolia.dart
+++ b/lib/algolia.dart
@@ -3,7 +3,8 @@ library algolia;
 import 'dart:async';
 import 'dart:convert';
 import 'package:meta/meta.dart';
-import 'package:http/http.dart';
+import 'package:http/http.dart'
+    if (dart.library.js) 'package:node_http/node_http.dart';
 import 'package:uuid/uuid.dart';
 
 part 'src/algolia.dart';
diff --git a/lib/src/object_reference.dart b/lib/src/object_reference.dart
index 1a6889a..82b9ddf 100644
--- a/lib/src/object_reference.dart
+++ b/lib/src/object_reference.dart
@@ -12,6 +12,7 @@ class AlgoliaObjectReference {
 
   String get index => _index;
   String get objectID => _objectId;
+  String get encodedObjectID => Uri.encodeComponent(objectID);
 
   /// Get the object referred to by this [AlgoliaObjectReference].
   ///
@@ -19,7 +20,7 @@ class AlgoliaObjectReference {
   Future<AlgoliaObjectSnapshot> getObject() async {
     assert(_objectId != null, 'You can\'t get an object without an objectID.');
     try {
-      String url = '${algolia._host}indexes/$_index/$_objectId';
+      String url = '${algolia._host}indexes/$_index/$encodedObjectID';
       Response response = await get(
         url,
         headers: algolia._header,
@@ -40,7 +41,7 @@ class AlgoliaObjectReference {
           'IndexName is required, but it has `*` multiple flag or `null`.');
       String url = '${algolia._host}indexes/$_index';
       if (_objectId != null) {
-        url = '$url/$_objectId';
+        url = '$url/$encodedObjectID';
       }
       Response response = await post(
         url,
@@ -69,7 +70,7 @@ class AlgoliaObjectReference {
           'IndexName is required, but it has `*` multiple flag or `null`.');
       String url = '${algolia._host}indexes/$_index';
       if (_objectId != null) {
-        url = '$url/$_objectId';
+        url = '$url/$encodedObjectID';
       }
       data['objectID'] = _objectId;
       Response response = await put(
@@ -136,7 +137,7 @@ class AlgoliaObjectReference {
     try {
       String url = '${algolia._host}indexes/$_index';
       if (_objectId != null) {
-        url = '$url/$_objectId';
+        url = '$url/$encodedObjectID';
       }
       Response response = await delete(
         url,
diff --git a/pubspec.lock b/pubspec.lock
index 703baf4..084c3f7 100644
--- a/pubspec.lock
+++ b/pubspec.lock
@@ -1,5 +1,5 @@
 # Generated by pub
-# See https://www.dartlang.org/tools/pub/glossary#lockfile
+# See https://dart.dev/tools/pub/glossary#lockfile
 packages:
   analyzer:
     dependency: transitive
@@ -148,6 +148,27 @@ packages:
       url: "https://pub.dartlang.org"
     source: hosted
     version: "1.0.2"
+  node_http:
+      dependency: "direct main"
+      description:
+        name: node_http
+        url: "https://pub.dartlang.org"
+      source: hosted
+      version: "1.0.0"
+    node_interop:
+      dependency: transitive
+      description:
+        name: node_interop
+        url: "https://pub.dartlang.org"
+      source: hosted
+      version: "1.0.3"
+    node_io:
+      dependency: transitive
+      description:
+        name: node_io
+        url: "https://pub.dartlang.org"
+      source: hosted
+      version: "1.0.1+2"
   node_preamble:
     dependency: transitive
     description:
diff --git a/pubspec.yaml b/pubspec.yaml
index 1297901..915698f 100644
--- a/pubspec.yaml
+++ b/pubspec.yaml
@@ -12,6 +12,7 @@ environment:
 dependencies:
   meta: ^1.1.6
   http: ^0.12.0
+  node_http: ^1.0.0
   uuid: ^2.0.1
 
 dev_dependencies:
-- 
2.23.0

